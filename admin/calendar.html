<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Calendar Management | Photon Capture</title>
    <meta name="robots" content="noindex, nofollow">

    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="css/style.css">

    <style>
        /* Import same design system */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400&display=swap');

        :root {
            --bg-color: #050505;
            --bg-secondary: #0a0a0a;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0;
            --accent-color: #ff3366;
            --accent-glow: rgba(255, 51, 102, 0.3);
            --glass-bg: rgba(10, 10, 10, 0.7);
            --glass-border: rgba(255, 255, 255, 0.08);
            --card-bg: #111111;
            --border-color: #333;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --font-heading: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;
            --max-width: 1400px;
            --header-height: 80px;
            --border-radius: 12px;
            --transition-speed: 0.3s;
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: var(--font-heading);
            font-weight: 500;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }

        /* Login Screen */
        #login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .login-box {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 3rem;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .login-box h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-box p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: 1rem;
            transition: all var(--transition-speed) ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .btn {
            padding: 0.75rem 2rem;
            border-radius: 50px;
            font-family: var(--font-body);
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            border: none;
            width: 100%;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 10px 30px var(--accent-glow);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px var(--accent-glow);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        /* Admin Dashboard */
        #admin-dashboard {
            display: none;
            min-height: 100vh;
        }

        header {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--glass-border);
            padding: 1.5rem 2rem;
        }

        .header-container {
            max-width: var(--max-width);
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .logo span {
            color: var(--accent-color);
        }

        .btn-logout {
            padding: 0.5rem 1.5rem;
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            border-radius: 50px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .btn-logout:hover {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        main {
            max-width: var(--max-width);
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--text-secondary);
        }

        .controls-bar {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .month-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .month-selector button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all var(--transition-speed) ease;
        }

        .month-selector button:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }

        .month-selector h2 {
            font-size: 1.5rem;
            min-width: 200px;
            text-align: center;
        }

        .btn-secondary {
            padding: 0.5rem 1.5rem;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            transition: all var(--transition-speed) ease;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px var(--accent-glow);
        }

        /* Calendar Grid */
        .calendar-grid {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 2rem;
        }

        .weekday-labels {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .weekday-label {
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .day-cell {
            aspect-ratio: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .day-cell:hover:not(.empty):not(.past) {
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .day-cell.empty {
            background: transparent;
            border: none;
            cursor: default;
        }

        .day-cell.past {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .day-cell.today {
            border-color: var(--accent-color);
            border-width: 2px;
        }

        .day-cell.has-slots {
            border-color: var(--success-color);
        }

        .day-number {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .slot-count {
            font-size: 0.7rem;
            color: var(--success-color);
            margin-top: auto;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-header h2 {
            font-size: 1.5rem;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 2rem;
            cursor: pointer;
            line-height: 1;
            transition: color var(--transition-speed) ease;
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .time-slots-list {
            margin-bottom: 2rem;
        }

        .time-slot-item {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-slot-time {
            font-weight: 500;
        }

        .btn-delete {
            background: transparent;
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all var(--transition-speed) ease;
        }

        .btn-delete:hover {
            background: var(--danger-color);
            color: white;
        }

        .add-slot-form {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .add-slot-form input {
            flex: 1;
        }

        .btn-add {
            padding: 0.75rem 1.5rem;
            background: var(--success-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
        }

        .btn-add:hover {
            background: #059669;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .status-available {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success-color);
        }

        .status-limited {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning-color);
        }

        .status-full {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
        }

        @media (max-width: 768px) {
            .controls-bar {
                flex-direction: column;
            }

            .month-selector h2 {
                font-size: 1.2rem;
            }

            .days-grid {
                gap: 0.25rem;
            }

            .day-cell {
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body>
    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-box">
            <h1>Admin Login</h1>
            <p>Calendar Management System</p>

            <div id="login-error" class="error-message">Falsches Passwort</div>

            <form id="login-form">
                <div class="form-group">
                    <label for="password">Passwort</label>
                    <input type="password" id="password" class="form-control" required autofocus>
                </div>
                <button type="submit" class="btn btn-primary">Anmelden</button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard">
        <header>
            <div class="header-container">
                <div class="logo">Photon<span>-Capture</span> <span
                        style="font-size: 0.8rem; color: var(--text-secondary);">Admin</span></div>
                <button id="logout-btn" class="btn-logout">Abmelden</button>
            </div>
        </header>

        <main>
            <div class="page-header">
                <h1>Kalender-Verwaltung</h1>
                <p>Verwalte verf√ºgbare Zeitfenster f√ºr Buchungen</p>
            </div>

            <div class="controls-bar">
                <div class="month-selector">
                    <button id="prev-month">‚Üê</button>
                    <h2 id="current-month">November 2025</h2>
                    <button id="next-month">‚Üí</button>
                </div>
                <button id="export-data" class="btn-secondary">Daten Exportieren</button>
            </div>

            <div class="calendar-grid">
                <div class="weekday-labels">
                    <div class="weekday-label">Mo</div>
                    <div class="weekday-label">Di</div>
                    <div class="weekday-label">Mi</div>
                    <div class="weekday-label">Do</div>
                    <div class="weekday-label">Fr</div>
                    <div class="weekday-label">Sa</div>
                    <div class="weekday-label">So</div>
                </div>
                <div class="days-grid" id="days-grid">
                    <!-- Generated by JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <!-- Time Slots Edit Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Zeitfenster bearbeiten</h2>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>

            <div id="modal-date" style="color: var(--text-secondary); margin-bottom: 1.5rem;"></div>

            <div class="time-slots-list" id="time-slots-list">
                <!-- Generated by JavaScript -->
            </div>

            <div class="add-slot-form" style="display: none;">
                <input type="time" id="new-slot-time" class="form-control" placeholder="Neue Zeit">
                <button id="add-slot-btn" class="btn-add">Hinzuf√ºgen</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = 'api';

        // State
        let currentDate = new Date();
        let availabilityData = {};
        let selectedDate = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            setupEventListeners();
        });

        // Authentication
        async function checkAuth() {
            try {
                const response = await fetch(`${API_BASE}/auth.php`);
                const data = await response.json();

                if (data.loggedIn) {
                    showDashboard();
                    loadAvailabilityData();
                } else {
                    showLogin();
                }
            } catch (err) {
                console.error('Auth check failed:', err);
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('admin-dashboard').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'block';
            renderCalendar();
        }

        // Event Listeners
        function setupEventListeners() {
            // Login
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const password = document.getElementById('password').value;

                try {
                    const response = await fetch(`${API_BASE}/auth.php`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ password })
                    });

                    const data = await response.json();

                    if (data.success) {
                        showDashboard();
                        loadAvailabilityData();
                    } else {
                        document.getElementById('login-error').style.display = 'block';
                        document.getElementById('login-error').textContent = 'Falsches Passwort';
                    }
                } catch (err) {
                    console.error('Login error:', err);
                    document.getElementById('login-error').style.display = 'block';
                    document.getElementById('login-error').textContent = 'Serverfehler';
                }
            });

            // Logout
            document.getElementById('logout-btn').addEventListener('click', async () => {
                await fetch(`${API_BASE}/auth.php?action=logout`);
                showLogin();
            });

            // Month navigation
            document.getElementById('prev-month').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            document.getElementById('next-month').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            // Modal
            document.getElementById('modal-close').addEventListener('click', closeModal);
            document.getElementById('edit-modal').addEventListener('click', (e) => {
                if (e.target.id === 'edit-modal') closeModal();
            });

            // Add slot
            document.getElementById('add-slot-btn').addEventListener('click', addTimeSlot);

            // Export data
            document.getElementById('export-data').addEventListener('click', exportData);
        }

        // Load/Save Data
        async function loadAvailabilityData() {
            try {
                const response = await fetch(`${API_BASE}/calendar.php`);
                availabilityData = await response.json();
                renderCalendar();
            } catch (err) {
                console.error('Failed to load data:', err);
            }
        }

        async function saveAvailabilityData() {
            try {
                const response = await fetch(`${API_BASE}/calendar.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(availabilityData)
                });

                if (!response.ok) {
                    throw new Error('Save failed');
                }

                renderCalendar(); // Refresh display
            } catch (err) {
                console.error('Failed to save data:', err);
                alert('Fehler beim Speichern! Bitte pr√ºfen Sie Ihre Verbindung.');
            }
        }

        // Calendar Rendering
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthNames = ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];

            document.getElementById('current-month').textContent = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = (firstDay.getDay() + 6) % 7;

            const daysGrid = document.getElementById('days-grid');
            daysGrid.innerHTML = '';

            // Empty cells
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'day-cell empty';
                daysGrid.appendChild(emptyCell);
            }

            // Days
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = formatDate(date);
                const dayCell = createDayCell(date, dateStr, today);
                daysGrid.appendChild(dayCell);
            }
        }

        function createDayCell(date, dateStr, today) {
            const dayCell = document.createElement('div');
            dayCell.className = 'day-cell';

            if (date < today) {
                dayCell.classList.add('past');
            }

            if (date.getTime() === today.getTime()) {
                dayCell.classList.add('today');
            }

            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = date.getDate();
            dayCell.appendChild(dayNumber);

            // Check availability status
            const availability = availabilityData[dateStr];
            if (availability && date >= today) {
                const status = availability.status || 'available';

                dayCell.classList.add('has-slots');
                const statusText = document.createElement('div');
                statusText.className = 'slot-count';

                if (status === 'booked') {
                    statusText.style.color = 'var(--danger-color)';
                    statusText.textContent = 'Gebucht';
                } else if (status === 'reserved') {
                    statusText.style.color = 'var(--warning-color)';
                    statusText.textContent = 'Reserviert';
                } else if (status === 'limited') {
                    statusText.style.color = 'var(--warning-color)';
                    statusText.textContent = 'Begrenzt';
                } else {
                    statusText.style.color = 'var(--success-color)';
                    statusText.textContent = 'Verf√ºgbar';
                }

                dayCell.appendChild(statusText);
            }

            // Click handler
            if (date >= today) {
                dayCell.addEventListener('click', () => openEditModal(dateStr, date));
            }

            return dayCell;
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Modal Functions
        function openEditModal(dateStr, date) {
            selectedDate = dateStr;
            const modal = document.getElementById('edit-modal');

            // Format date display
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateDisplay = date.toLocaleDateString('de-DE', options);

            document.getElementById('modal-title').textContent = 'Tag-Verf√ºgbarkeit';
            document.getElementById('modal-date').textContent = dateDisplay;

            renderDayStatus();
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('edit-modal').classList.remove('active');
            selectedDate = null;
        }

        function renderDayStatus() {
            const container = document.getElementById('time-slots-list');
            const availability = availabilityData[selectedDate];

            // Determine current status
            let currentStatus = 'available';
            if (availability) {
                if (availability.status === 'booked' || availability.reserved === true) {
                    currentStatus = 'booked';
                } else if (availability.status === 'reserved') {
                    currentStatus = 'reserved';
                } else if (availability.status === 'limited') {
                    currentStatus = 'limited';
                } else {
                    currentStatus = 'available';
                }
            }

            // Status display config
            const statusConfig = {
                available: { icon: '‚úÖ', label: 'Verf√ºgbar', color: 'var(--success-color)' },
                limited: { icon: '‚ö†Ô∏è', label: 'Begrenzte Verf√ºgbarkeit', color: 'var(--warning-color)' },
                reserved: { icon: '‚è≥', label: 'Reserviert (Anfrage)', color: 'var(--warning-color)' },
                booked: { icon: 'üîí', label: 'Gebucht (Best√§tigt)', color: 'var(--danger-color)' }
            };

            const current = statusConfig[currentStatus];

            container.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">
                        ${current.icon}
                    </div>
                    <h3 style="margin-bottom: 1.5rem; color: ${current.color};">
                        ${current.label}
                    </h3>
                    
                    <div style="margin-top: 2rem;">
                        <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">Status √§ndern:</p>
                        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <button onclick="setDayStatus('available')" 
                                class="btn-secondary" 
                                style="background: ${currentStatus === 'available' ? 'var(--success-color)' : 'transparent'}; 
                                       border: 1px solid var(--success-color); 
                                       color: ${currentStatus === 'available' ? 'white' : 'var(--success-color)'};">
                                ‚úÖ Als verf√ºgbar markieren
                            </button>
                            <button onclick="setDayStatus('limited')" 
                                class="btn-secondary" 
                                style="background: ${currentStatus === 'limited' ? 'var(--warning-color)' : 'transparent'}; 
                                       border: 1px solid var(--warning-color); 
                                       color: ${currentStatus === 'limited' ? 'white' : 'var(--warning-color)'};">
                                ‚ö†Ô∏è Als begrenzt verf√ºgbar markieren
                            </button>
                            <button onclick="setDayStatus('reserved')" 
                                class="btn-secondary" 
                                style="background: ${currentStatus === 'reserved' ? 'var(--warning-color)' : 'transparent'}; 
                                       border: 1px solid var(--warning-color); 
                                       color: ${currentStatus === 'reserved' ? 'white' : 'var(--warning-color)'};">
                                ‚è≥ Als reserviert markieren (Anfrage offen)
                            </button>
                            <button onclick="setDayStatus('booked')" 
                                class="btn-secondary" 
                                style="background: ${currentStatus === 'booked' ? 'var(--danger-color)' : 'transparent'}; 
                                       border: 1px solid var(--danger-color); 
                                       color: ${currentStatus === 'booked' ? 'white' : 'var(--danger-color)'};">
                                üîí Als gebucht markieren (Best√§tigt)
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function setDayStatus(status) {
            if (!availabilityData[selectedDate]) {
                availabilityData[selectedDate] = {};
            }

            // Set status based on the choice
            if (status === 'available') {
                availabilityData[selectedDate].status = 'available';
                availabilityData[selectedDate].reserved = false;
            } else if (status === 'limited') {
                availabilityData[selectedDate].status = 'limited';
                availabilityData[selectedDate].reserved = false;
            } else if (status === 'reserved') {
                availabilityData[selectedDate].status = 'reserved';
                availabilityData[selectedDate].reserved = false;
            } else if (status === 'booked') {
                availabilityData[selectedDate].status = 'booked';
                availabilityData[selectedDate].reserved = true;
            }

            saveAvailabilityData();
            closeModal(); // Close modal immediately for faster workflow
        }

        function toggleDayAvailability() {
            // Legacy function - replaced by setDayStatus
            if (!availabilityData[selectedDate]) {
                availabilityData[selectedDate] = { reserved: false, status: 'available' };
            }

            const currentStatus = availabilityData[selectedDate].reserved || availabilityData[selectedDate].status === 'booked';

            if (currentStatus) {
                // Make available
                availabilityData[selectedDate].reserved = false;
                availabilityData[selectedDate].status = 'available';
            } else {
                // Make reserved
                availabilityData[selectedDate].reserved = true;
                availabilityData[selectedDate].status = 'booked';
            }

            saveAvailabilityData();
            renderDayStatus();
        }

        // Export/Import
        function exportData() {
            const dataStr = JSON.stringify(availabilityData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `calendar-availability-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }


        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            loadAvailabilityData();
            checkAuth();
            setupEventListeners();
        });
    </script>
</body>

</html>